# -*- eval: (add-hook (quote org-babel-after-execute-hook) (function org-redisplay-inline-images)); -*-
#+STARTUP: inlineimages entitiespretty

These are benchmarks made while integrating NeoEMF and EMF Views.  All times are
in milliseconds, unless otherwise specified.  Sizes are in KB, as reported by
~ls--block-size=K~ for XMI files, and ~du~ for GraphDB folders.

* Versions and parameters
** EMF
Standard EMF available in Eclipse.

EMF version: 2.13.0.v20170609-0928

Default loading and saving options (empty map) unless otherwise specified.

** SOM-NeoEMF
Basically NeoEMF 1.0.2 with a few patches.

https://github.com/SOM-Research/NeoEMF
Commit used: 9a876b402fa38983e4d1f95ccf2b0ca44068b5da

Unless otherwise specified, saving options are:
: BlueprintsNeo4jOptionsBuilder.newBuilder().weakCache().autocommit().asMap();

Loading options are:
: BlueprintsNeo4jOptionsBuilder.newBuilder().asMap();

(actual options will depend on how the resource was serialized)

For DirectWriteLongList, saving options are:
: BlueprintsNeo4jOptionsBuilder.newBuilder()
:   .weakCache().directWriteLongListSupport().autocommit().asMap();

For loading:
: BlueprintsNeo4jOptionsBuilder.newBuilder()
:   .softCache().directWriteLongListSupport().asMap();

** atlanmod-NeoEMF
1100 commits beyond 1.0.2, with large refactorings.

https://github.com/atlanmod/NeoEMF
Commit used: ed6f37e2ef0bf25e32b12659e8d09285c254cfe4

Unless otherwise specified, saving options are:
: BlueprintsNeo4jConfig.newConfig().autoSave().toMap();

Loading options are:
: BlueprintsNeo4jConfig.newConfig().toMap();

* Create trace models
Create trace models up to size 10^6, serialized as XMI, or in a database.

Legend:
- Size :: number of Log elements in the resource (10^n)
- Populate :: time to add all the elements to the provided resource
- Full :: time to create the resource, populate it, save it and eventually close
          it (for NeoEMF)
- XMI :: size of the XMI file on disk
- GraphDB :: size of the GraphDB folder on disk

** Using EMF

#+name: create-emf
| size | populate | full |    XMI |
|------+----------+------+--------|
|    1 |      229 |  339 |      2 |
|    2 |        1 |    5 |     12 |
|    3 |        7 |   28 |    118 |
|    4 |       36 |   98 |   1178 |
|    5 |      135 |  332 |  11778 |
|    6 |      524 | 1485 | 117774 |

** Using SOM-NeoEMF
*** Using DirectWriteLongListSupport
Using saving options:
: BlueprintsNeo4jOptionsBuilder.newBuilder()
:   .weakCache().directWriteLongListSupport().autocommit().asMap();

#+name: create-som-neoemf-long-list
| size | populate |    full | GraphDB (KB) |
|------+----------+---------+--------------|
|    1 |      376 |    2627 |          348 |
|    2 |      377 |     985 |          764 |
|    3 |      842 |    1730 |         5000 |
|    4 |     8941 |   10594 |        47828 |
|    5 |    97795 |   99768 |       473992 |
|    6 |  1122814 | 1123521 |      4755528 |

*** Using DirectWrite
Saving options:
: BlueprintsNeo4jOptionsBuilder.newBuilder()
:   .weakCache().autocommit().asMap();

#+name: create-som-neoemf
| size | populate |    full | GraphDB (KB) |
|------+----------+---------+--------------|
|    1 |      203 |    1827 |          336 |
|    2 |      251 |     832 |          588 |
|    3 |     1003 |    1703 |         3276 |
|    4 |    21434 |   22697 |        30312 |
|    5 |  2537824 | 2539457 |       346072 |
|    6 |        n |       n |            n |

** Using atlanmod-NeoEMF

#+name: create-atlanmod-neoemf
| size |    full | GraphDB (KB) |
|------+---------+--------------|
|    1 |    6677 |          648 |
|    2 |    1497 |          784 |
|    3 |    2415 |         2200 |
|    4 |   35925 |        16368 |
|    5 | 3190291 |       171304 |
|    6 |       n |            n |

** Aggregate results and graphs
*** Time for creating the trace model

#+name: agg-create
| size |  EMF | SOM-NeoEMF-LL | SOM-NeoEMF | AtlanMod-NeoEMF |
|------+------+---------------+------------+-----------------|
|    1 |  339 |          2627 |       1827 |            6677 |
|    2 |    5 |           985 |        832 |            1497 |
|    3 |   28 |          1730 |       1703 |            2415 |
|    4 |   98 |         10594 |      22697 |           35925 |
|    5 |  332 |         99768 |    2539457 |         3190291 |
|    6 | 1485 |       1123521 |          n |               n |
#+TBLFM: @2$2..@>$2=remote(create-emf, @@#$3)
#+TBLFM: @2$3..@>$3=remote(create-som-neoemf-long-list,@@#$3)
#+TBLFM: @2$4..@>$4=remote(create-som-neoemf,@@#$3)
#+TBLFM: @2$5..@>$5=remote(create-atlanmod-neoemf,@@#$2)

#+begin_src gnuplot :var data=agg-create :file bench-all-create-trace.png
set title 'Create trace model (time)'
set key left

set xlabel 'model size'
set logscale x
set ylabel 'time (ms)'
set logscale y

plot data u (10**$1):2 w lp title 'EMF', \
     data u (10**$1):4 w lp title 'SOM-NeoEMF', \
     data u (10**$1):3 w lp title 'SOM-NeoEMF-LL', \
     data u (10**$1):5 w lp title 'Atl-NeoEMF'
#+end_src

#+RESULTS:
[[file:bench-all-create-trace.png]]

*** Size of trace model on disk
#+name: agg-create-size
| size |    EMF | SOM-NeoEMF-LL | SOM-NeoEMF | AtlanMod-NeoEMF |
|------+--------+---------------+------------+-----------------|
|    1 |      2 |           348 |        336 |             648 |
|    2 |     12 |           764 |        588 |             784 |
|    3 |    118 |          5000 |       3276 |            2200 |
|    4 |   1178 |         47828 |      30312 |           16368 |
|    5 |  11778 |        473992 |     346072 |          171304 |
|    6 | 117774 |       4755528 |          n |               n |
#+TBLFM: @2$2..@>$2=remote(create-emf, @@#$4)
#+TBLFM: @2$3..@>$3=remote(create-som-neoemf-long-list,@@#$4)
#+TBLFM: @2$4..@>$4=remote(create-som-neoemf,@@#$4)
#+TBLFM: @2$5..@>$5=remote(create-atlanmod-neoemf,@@#$3)

#+begin_src gnuplot :var data=agg-create-size :file bench-all-create-trace-size.png
set title 'Create trace model (size)'
set key left

set xlabel 'model size (10^n)'
set logscale x
set ylabel 'size (KB)'
set logscale y

plot data u (10**$1):2 w lp title 'EMF (XMI)', \
     data u (10**$1):4 w lp title 'SOM-NeoEMF (GraphDB)', \
     data u (10**$1):3 w lp title 'SOM-NeoEMF-LL (GraphDB)', \
     data u (10**$1):5 w lp title 'Atl-NeoEMF (GraphDB)'
#+end_src

#+RESULTS:
[[file:bench-all-create-trace-size.png]]

* Create weaving models
Create a weaving model for a view aggregating the four models.  This
construction by-passes the ECL for the javaClass rule, since the naive ECL
algorithm is O(n*m).

We serialize the weaving model as XMI and as a database, for later comparisons
when running transformations and queries on views.

Legend:
- Size :: ibidem
- javaClass rule :: time to match the rule between the Trace and Java metamodels
- ECL rules :: time to match the remaining 2 rules with ECL (small models)
- Save :: time to serialize the WeavingModel resource
- Full :: time to do load the Trace model, match and save
- XMI :: size of the XMI weaving model on disk
- GraphDB :: size of the GraphDB folder on disk

** Using EMF trace
*** XMI weaving model
Average numbers after 5 warmups / 5 iterations.

#+name: xmi-weaving-emf
| Size | javaClass | ECL |   save |   full |    XMI |
|------+-----------+-----+--------+--------+--------|
|    1 |        15 |  61 |      2 |     80 |     11 |
|    2 |        11 |  54 |      5 |     73 |     36 |
|    3 |        14 |  36 |      9 |     67 |    285 |
|    4 |        52 |  39 |    102 |    216 |   2799 |
|    5 |      1868 |  25 |   3821 |   5877 |  28112 |
|    6 |    160090 |  21 | 345742 | 507584 | 282994 |

*** NeoEMF weaving model

#+name: neo-weaving-emf
| Size | load | javaClass | ECL |  save |   full | GraphDB |
|------+------+-----------+-----+-------+--------+---------|
|    1 |    4 |       158 | 324 |  1390 |   1886 |     484 |
|    2 |   14 |        72 |  82 |   737 |    908 |     976 |
|    3 |   52 |       195 |  81 |  1136 |   1466 |    6068 |
|    4 |  138 |      1484 |  72 |  4294 |   5991 |   57520 |
|    5 |  256 |    217313 | 351 | 28999 | 246919 |  638876 |
|    6 |    n |         n |   n |     n |      n |       n |

** Using SOM-NeoEMF trace
*** XMI weaving model

#+name: xmi-weaving-som-neoemf
| Size | load | javaClass | ECL | save |    full |   XMI |
|------+------+-----------+-----+------+---------+-------|
|    1 | 1277 |      1119 |  66 |    2 |    2543 |    11 |
|    2 |   79 |       234 |  71 |    2 |     471 |    37 |
|    3 |   47 |      1065 |  33 |    6 |    1245 |   297 |
|    4 |   25 |     20680 |  40 |   74 |   20901 |  2908 |
|    5 |  205 |   2123328 |  38 | 1905 | 2125560 | 29099 |
|    6 |    n |         n |   n |    n |       n |     n |

*** NeoEMF weaving model
**** DirectWrite

#+name: neo-weaving-som-neoemf
| Size | load | javaClass | ECL |  save |    full | GraphDB |
|------+------+-----------+-----+-------+---------+---------|
|    1 |   62 |        52 |  46 |   569 |     810 |     932 |
|    2 |   25 |        61 |  61 |   675 |     900 |   12412 |
|    3 |   33 |       314 |  30 |   887 |    1347 |   16684 |
|    4 |   47 |     26422 |  47 |  2386 |   28988 |   67780 |
|    5 |   31 |   3049003 | 113 | 26780 | 3076031 |  649116 |
|    6 |    n |         n |   n |     n |       n |       n |

**** DirectWriteLongList

#+name: neo-weaving-som-neoemf-long-list
| Size | load | javaClass | ECL | save |    full |  GraphDB |
|------+------+-----------+-----+------+---------+----------|
|    1 | 1139 |       522 | 471 |  344 |    3077 |      704 |
|    2 |  337 |       428 | 145 |  324 |    1661 |     1828 |
|    3 |  462 |      1537 | 118 |  956 |    3485 |    13284 |
|    4 |  252 |     14962 |  75 | 1934 |   17587 |   130736 |
|    5 |  333 |    105165 |  64 |  583 |  106681 |  1316776 |
|    6 |  190 |   1340860 |  68 | 1551 | 1353340 | 13263500 |

** Using atlanmod-NeoEMF trace
*** XMI weaving model

#+name: xmi-weaving-atl-neoemf
| size | load | populate | save |   full | GraphDB |
|------+------+----------+------+--------+---------|
|    1 | 1149 |      166 |   18 |   4658 |     484 |
|    2 |  151 |      123 |   10 |    481 |     967 |
|    3 |  124 |      506 |   41 |    866 |    6068 |
|    4 |   96 |    11181 |  134 |  11593 |   57520 |
|    5 |  113 |   945415 | 2422 | 948163 |  638884 |
|    6 |    n |        n |    n |      n |       n |

*** NeoEMF weaving model

#+name: neo-weaving-atl-neoemf
| size | load | populate |    save |     full | GraphDB |
|------+------+----------+---------+----------+---------|
|    1 |  101 |      149 |    1082 |     1632 |     536 |
|    2 |   95 |      228 |    1198 |     1722 |     744 |
|    3 |  148 |     2106 |    2277 |     4718 |    2920 |
|    4 |   98 |   102354 |   43393 |   146230 |   24660 |
|    5 |  179 | 10056899 | 3853064 | 13912304 |  293236 |
|    6 |    n |        n |       n |        n |       n |

** Aggregate results and graphs
*** Time to create weaving models
#+name: agg-weaving
| size | EMF (XMI) | EMF (DB) | SOM-NeoEMF (XMI) | SOM-NeoEMF (DB) | SOM-NeoEMF-LL (DB) | Atl-NeoEMF (XMI) | Atl-NeoEMF (DB) |
|------+-----------+----------+------------------+-----------------+--------------------+------------------+-----------------|
|    1 |        80 |     1886 |             2543 |             810 |               3077 |             4658 |            1632 |
|    2 |        73 |      908 |              471 |             900 |               1661 |              481 |            1722 |
|    3 |        67 |     1466 |             1245 |            1347 |               3485 |              866 |            4718 |
|    4 |       216 |     5991 |            20901 |           28988 |              17587 |            11593 |          146230 |
|    5 |      5877 |   246919 |          2125560 |         3076031 |             106681 |           948163 |        13912304 |
|    6 |    507584 |        n |                n |               n |            1353340 |                n |               n |
#+TBLFM: @2$2..@>$2=remote(xmi-weaving-emf, @@#$5)
#+TBLFM: @2$3..@>$3=remote(neo-weaving-emf, @@#$6)
#+TBLFM: @2$4..@>$4=remote(xmi-weaving-som-neoemf,@@#$6)
#+TBLFM: @2$5..@>$5=remote(neo-weaving-som-neoemf,@@#$6)
#+TBLFM: @2$6..@>$6=remote(neo-weaving-som-neoemf-long-list,@@#$6)
#+TBLFM: @2$7..@>$7=remote(xmi-weaving-atl-neoemf,@@#$5)
#+TBLFM: @2$8..@>$8=remote(neo-weaving-atl-neoemf,@@#$5)

#+begin_src gnuplot :var data=agg-weaving :file bench-all-create-weaving-time.png
set title 'Create weaving models (time)'
set key left font ",9"

set xlabel 'model size (10^n)'
set logscale x
set ylabel 'time (ms)'
set logscale y

plot data u (10**$1):2 w lp title 'EMF (XMI)', \
     data u (10**$1):5 w lp title 'SOM-NeoEMF (DB)', \
     data u (10**$1):6 w lp title 'SOM-NeoEMF-LL (DB)', \
     data u (10**$1):8 w lp title 'Atl-NeoEMF (DB)'
#+end_src

#+RESULTS:
[[file:bench-all-create-weaving-time.png]]

*** Size of weaving models on disk
#+name: agg-weaving-size
| size | EMF (XMI) | EMF (DB) | SOM-NeoEMF (XMI) | SOM-NeoEMF (DB) | SOM-NeoEMF-LL (DB) | Atl-NeoEMF (XMI) | Atl-NeoEMF (DB) |
|------+-----------+----------+------------------+-----------------+--------------------+------------------+-----------------|
|    1 |        11 |      484 |               11 |             932 |                704 |              484 |             536 |
|    2 |        36 |      976 |               37 |           12412 |               1828 |              967 |             744 |
|    3 |       285 |     6068 |              297 |           16684 |              13284 |             6068 |            2920 |
|    4 |      2799 |    57520 |             2908 |           67780 |             130736 |            57520 |           24660 |
|    5 |     28112 |   638876 |            29099 |          649116 |            1316776 |           638884 |          293236 |
|    6 |    282994 |        n |                n |               n |           13263500 |                n |               n |
#+TBLFM: @2$2..@>$2=remote(xmi-weaving-emf, @@#$6)
#+TBLFM: @2$3..@>$3=remote(neo-weaving-emf, @@#$7)
#+TBLFM: @2$4..@>$4=remote(xmi-weaving-som-neoemf,@@#$7)
#+TBLFM: @2$5..@>$5=remote(neo-weaving-som-neoemf,@@#$7)
#+TBLFM: @2$6..@>$6=remote(neo-weaving-som-neoemf-long-list,@@#$7)
#+TBLFM: @2$7..@>$7=remote(xmi-weaving-atl-neoemf,@@#$6)
#+TBLFM: @2$8..@>$8=remote(neo-weaving-atl-neoemf,@@#$6)

#+begin_src gnuplot :var data=agg-weaving-size :file bench-all-create-weaving-size.png
set title 'Create weaving models (size)'
set key left font ",9"

set xlabel 'model size (10^n)'
set logscale x
set ylabel 'size (KB)'
set logscale y

plot data u (10**$1):2 w lp title 'EMF (XMI)', \
     data u (10**$1):4 w lp title 'SOM-NeoEMF (XMI)', \
     data u (10**$1):7 w lp title 'Atl-NeoEMF (XMI)', \
     data u (10**$1):3 w lp title 'EMF (DB)', \
     data u (10**$1):5 w lp title 'SOM-NeoEMF (DB)', \
     data u (10**$1):6 w lp title 'SOM-NeoEMF-LL (DB)', \
     data u (10**$1):8 w lp title 'Atl-NeoEMF (DB)'
#+end_src

#+RESULTS:
[[file:bench-all-create-weaving-size.png]]

* Run ATL transformation
Execute an ATL transformation on the view that touches all models (including all
elements of the trace model).

Legend:
- Size :: ibidem
- Load :: time to load the viewpoint and view resources
- Transform :: time to run the transformation (execute ~ExecEnv.run~)
- Full :: time to load the resources, init ATL, and execute the transformation

** Using EMF trace
Average numbers after 5 warmups / 5 iterations

*** XMI weaving model

#+name: xmi-atl-emf
| Size | Load | Transform |   Full |
|------+------+-----------+--------|
|    1 |  220 |       650 |    885 |
|    2 |  152 |       655 |    821 |
|    3 |  161 |      1078 |   1250 |
|    4 |  494 |      6135 |   6643 |
|    5 | 3768 |    130397 | 134223 |
|    6 |    n |         n |      n |

** Using SOM-NeoEMF trace
*** XMI weaving model

#+name: xmi-atl-som-neoemf
| size | load | transform |    full |
|------+------+-----------+---------|
|    1 |  896 |       917 |    2072 |
|    2 |  329 |       617 |    1143 |
|    3 |  533 |      1820 |    2890 |
|    4 | 1346 |     58789 |   60334 |
|    5 | 6786 |   5616109 | 5623177 |
|    6 |    n |         n |       n |

*** NeoEMF weaving model

#+name: neo-atl-som-neoemf
| size |    load | transform |    full |
|------+---------+-----------+---------|
|    1 |     228 |       698 |    1148 |
|    2 |     238 |       963 |    1458 |
|    3 |     575 |      1468 |    2230 |
|    4 |   23394 |     65338 |   88937 |
|    5 | 2157699 |   4944843 | 7102815 |
|    6 |       n |         n |       n |

** Using atlanmod-NeoEMF trace
*** XMI weaving model

#+name: xmi-atl-atl-neoemf
| Size | load | transform |    full |
|------+------+-----------+---------|
|    1 | 4294 |      1664 |    6727 |
|    2 |  472 |       795 |    1621 |
|    3 |  388 |      1998 |    2711 |
|    4 |  448 |     36373 |   37096 |
|    5 | 1069 |   3334126 | 3335569 |
|    6 |    n |         n |       n |

*** NeoEMF weaving model

#+name: neo-atl-atl-neoemf
| Size | load | transform |    full |
|------+------+-----------+---------|
|    1 |  522 |       515 |    1296 |
|    2 |  515 |       468 |    1252 |
|    3 |  291 |      1551 |    2093 |
|    4 |  298 |     45316 |   45879 |
|    5 |  323 |   4069452 | 4070129 |
|    6 |    n |         n |       n |

** Aggregate results and graphs

#+name: agg-atl
| size | EMF (XMI) | EMF (DB) | SOM-NeoEMF (XMI) | SOM-NeoEMF (DB) | Atl-NeoEMF (XMI) | Atl-NeoEMF (DB) |
|------+-----------+----------+------------------+-----------------+------------------+-----------------|
|    1 |       885 | n        |             2072 |            1148 |             6727 |            1296 |
|    2 |       821 | n        |             1143 |            1458 |             1621 |            1252 |
|    3 |      1250 | n        |             2890 |            2230 |             2711 |            2093 |
|    4 |      6643 | n        |            60334 |           88937 |            37096 |           45879 |
|    5 |    134223 | n        |          5623177 |         7102815 |          3335569 |         4070129 |
|    6 |         n | n        |                n |               n |                n |               n |
#+TBLFM: @2$2..@>$2=remote(xmi-atl-emf, @@#$4)
#+TBLFM: @2$3..@>$3=remote(neo-atl-emf, @@#$4)
#+TBLFM: @2$4..@>$4=remote(xmi-atl-som-neoemf,@@#$4)
#+TBLFM: @2$5..@>$5=remote(neo-atl-som-neoemf,@@#$4)
#+TBLFM: @2$6..@>$6=remote(xmi-atl-atl-neoemf,@@#$4)
#+TBLFM: @2$7..@>$7=remote(neo-atl-atl-neoemf,@@#$4)

#+begin_src gnuplot :var data=agg-atl :file bench-all-run-atl.png
set title 'Run ATL transformation'
set key left font ",9"

set xlabel 'model size (10^n)'
set logscale x
set ylabel 'time (ms)'
set logscale y

plot data u (10**$1):2 w lp title 'EMF (XMI)', \
     data u (10**$1):5 w lp title 'SOM-NeoEMF (DB)', \
     data u (10**$1):7 w lp title 'Atl-NeoEMF (DB)'
#+end_src

#+RESULTS:
[[file:bench-all-run-atl.png]]

* Load view/model
Do a ~resource.load~ on each view.  Mainly to show that there are no overheads
to loading a view, even when backed with a DB resource.

Legend:
- Size :: ibidem
- Load :: time to lead the view resource
- First :: time get the first element in the view
- All :: time to enumerate all contents in the view

** Using EMF trace
*** No weaving model
#+name: xmi-load
| size | load | first |  all |
|------+------+-------+------|
|    1 |    8 |     0 |   14 |
|    2 |    3 |     0 |    4 |
|    3 |   26 |     0 |   28 |
|    4 |  103 |     0 |  111 |
|    5 |  614 |     0 |  649 |
|    6 | 2154 |     0 | 2341 |

*** View with XMI weaving model
#+name: xmi-view-load
| size |  load | first |   all |
|------+-------+-------+-------|
|    1 |   788 |     1 |  2259 |
|    2 |   257 |     0 |   754 |
|    3 |   245 |     0 |   714 |
|    4 |   389 |     0 |  1012 |
|    5 |   921 |     0 |  1869 |
|    6 | 12214 |     0 | 19361 |

** Using SOM-NeoEMF trace
*** No weaving model
**** DirectWrite
#+name: neoemf-load-direct-write
| size | load | first |     all |
|------+------+-------+---------|
|    1 |  735 |   169 |      26 |
|    2 |   54 |     9 |     209 |
|    3 |   42 |    11 |     705 |
|    4 |   94 |    35 |   14094 |
|    5 |   32 |   150 | 1359528 |
|    6 |    n |     n |       n |

**** DirectWriteLongList
#+name: neoemf-load-long-list
| size | load | first |    all |
|------+------+-------+--------|
|    1 |  657 |  1237 |   2104 |
|    2 |   64 |    19 |    459 |
|    3 |   51 |    13 |   1001 |
|    4 |   38 |    39 |   2207 |
|    5 |   35 |   185 |   9472 |
|    6 |   43 |  1046 | 130754 |

*** View with NeoEMF weaving model
#+name: neoemf-view-load-long-list
| size | load | first |    all |
|------+------+-------+--------|
|    1 | 2265 |     1 |   7557 |
|    2 |  870 |     0 |   4173 |
|    3 |  750 |     0 |   3245 |
|    4 |  811 |     0 |   3963 |
|    5 | 2482 |     0 |  11287 |
|    6 | 3006 |     0 | 140639 |

** Aggregate results and graphs
#+name: agg-load
| size |  XMI | XMI View |  NeoEMF | NeoEMF (LL) | NeoEMF View (LL) |
|------+------+----------+---------+-------------+------------------|
|    1 |   14 |     2259 |      26 |        2104 |             7557 |
|    2 |    4 |      754 |     209 |         459 |             4173 |
|    3 |   28 |      714 |     705 |        1001 |             3245 |
|    4 |  111 |     1012 |   14094 |        2207 |             3963 |
|    5 |  649 |     1869 | 1359528 |        9472 |            11287 |
|    6 | 2341 |    19361 |       n |      130754 |           140639 |
#+TBLFM: @2$2..@>$2=remote(xmi-load, @@#$4)
#+TBLFM: @2$3..@>$3=remote(xmi-view-load, @@#$4)
#+TBLFM: @2$4..@>$4=remote(neoemf-load-direct-write,@@#$4)
#+TBLFM: @2$5..@>$5=remote(neoemf-load-long-list,@@#$4)
#+TBLFM: @2$6..@>$6=remote(neoemf-view-load-long-list,@@#$4)

#+begin_src gnuplot :var data=agg-load :file bench-all-load-view.png
set title 'Load view (time)'
set key left font ",9"

set xlabel 'model size (10^n)'
set logscale x
set ylabel 'time (ms)'
set logscale y

plot data u (10**$1):2 w lp title 'XMI', \
     data u (10**$1):3 w lp title 'XMI View', \
     data u (10**$1):4 w lp title 'NeoEMF', \
     data u (10**$1):5 w lp title 'NeoEMF (LL)', \
     data u (10**$1):6 w lp title 'NeoEMF View (LL)'
#+end_src

#+RESULTS:
[[file:bench-all-load-view.png]]

* Running a simple OCL query
OCL query: ~Log.allInstances()->size()~

Legend:
- Size :: ibidem
- Load :: time to load the resource
- Eval :: time to ~ocl.evaluate(query)~
- Full :: time for all of the above, plus creating the OCL query from a parsed
          expression

** Using EMF trace
*** No weaving model
**** Default extent map
| size | load | eval | full |
|------+------+------+------|
|    1 |   11 |   11 |  337 |
|    2 |    4 |    0 |    7 |
|    3 |   18 |    2 |   23 |
|    4 |  103 |   10 |  116 |
|    5 |  400 |   82 |  485 |
|    6 | 2287 |  574 | 2863 |

**** Fast extent map
#+name: ocl-xmi
| size | load | eval | full |
|------+------+------+------|
|    1 |   15 |   14 |  285 |
|    2 |    5 |    1 |    9 |
|    3 |   28 |    2 |   41 |
|    4 |  147 |   11 |  160 |
|    5 |  464 |   90 |  557 |
|    6 | 2523 |  582 | 3107 |

*** XMI weaving model
**** Default extent map
| size |  load | eval |  full |
|------+-------+------+-------|
|    1 |   723 |  918 |  1644 |
|    2 |   261 |  572 |   835 |
|    3 |   202 |  619 |   824 |
|    4 |   336 |  645 |   984 |
|    5 |  1127 | 1069 |  2197 |
|    6 | 10935 | 5963 | 16900 |

**** Fast extent map
#+name: ocl-xmi-full-view
| size |  load | eval |  full |
|------+-------+------+-------|
|    1 |   860 |   54 |   917 |
|    2 |   397 |   26 |   426 |
|    3 |   360 |   28 |   390 |
|    4 |   574 |   31 |   608 |
|    5 |  1162 |   89 |  1252 |
|    6 | 12142 |  788 | 12932 |

** Using SOM-NeoEMF trace
*** No weaving model
**** Default extent map
| size | load |  eval |  full |
|------+------+-------+-------|
|    1 |  624 |    49 |  1107 |
|    2 |   71 |   215 |   452 |
|    3 |   48 |   481 |   780 |
|    4 |   24 |  1596 |  2101 |
|    5 |   70 |  9180 | 11699 |
|    6 |  358 | 66744 | 96720 |

**** Fast extent map
#+name: ocl-neoemf
| size | load |  eval |  full |
|------+------+-------+-------|
|    1 | 1772 |    14 |  1974 |
|    2 |  535 |    28 |   642 |
|    3 |  378 |    96 |   568 |
|    4 |  294 |   278 |   669 |
|    5 |  270 |  1073 |  1537 |
|    6 |  312 | 12742 | 14134 |

*** View on trace model
**** Default extent map
| size | load |  eval |   full |
|------+------+-------+--------|
|    1 |   39 |     6 |    183 |
|    2 |   32 |    28 |    199 |
|    3 |   37 |   134 |    319 |
|    4 |   42 |   784 |   1056 |
|    5 |  173 |  6597 |   8068 |
|    6 | 1190 | 72863 | 106762 |

**** Fast extent map
#+name: ocl-neoemf-simple-view
| size | load |  eval |  full |
|------+------+-------+-------|
|    1 |   45 |    12 |   133 |
|    2 |   29 |     6 |   115 |
|    3 |   31 |    26 |   143 |
|    4 |   41 |   174 |   299 |
|    5 |  197 |  1139 |  1428 |
|    6 |  863 | 12570 | 13646 |

*** View on four models
**** Default extent map
| size | load |  eval |   full |
|------+------+-------+--------|
|    1 | 2165 |  5375 |   7822 |
|    2 |  839 |  2956 |   4044 |
|    3 |  888 |  2173 |   3337 |
|    4 |  899 |  3080 |   4325 |
|    5 | 1056 |  8070 |  10581 |
|    6 | 3366 | 71819 | 110397 |

**** Fast extent map
#+name: ocl-neoemf-full-view
| size | load |  eval |  full |
|------+------+-------+-------|
|    1 |  551 |    18 |   718 |
|    2 | 1004 |    16 |  1184 |
|    3 |  568 |    29 |   743 |
|    4 |  414 |   149 |   711 |
|    5 |  635 |   954 |  1768 |
|    6 | 2383 | 14173 | 16900 |

** Aggregate results and graphs
#+name: agg-ocl
| size |  XMI | XMI View | NeoEMF | NeoEMF View (Simple) | NeoEMF View (Full) |
|------+------+----------+--------+----------------------+--------------------|
|    1 |  285 |      917 |   1974 |                  133 |                718 |
|    2 |    9 |      426 |    642 |                  115 |               1184 |
|    3 |   41 |      390 |    568 |                  143 |                743 |
|    4 |  160 |      608 |    669 |                  299 |                711 |
|    5 |  557 |     1252 |   1537 |                 1428 |               1768 |
|    6 | 3107 |    12932 |  14134 |                13646 |              16900 |
#+TBLFM: @2$2..@>$2=remote(ocl-xmi, @@#$4)
#+TBLFM: @2$3..@>$3=remote(ocl-xmi-full-view, @@#$4)
#+TBLFM: @2$4..@>$4=remote(ocl-neoemf,@@#$4)
#+TBLFM: @2$5..@>$5=remote(ocl-neoemf-simple-view,@@#$4)
#+TBLFM: @2$6..@>$6=remote(ocl-neoemf-full-view,@@#$4)

#+begin_src gnuplot :var data=agg-ocl :file bench-all-ocl-all-instances.png
set title 'OCL query (Log.allInstances()->size())'
set key left font ",9"

set xlabel 'model size (10^n)'
set logscale x
set ylabel 'time (ms)'
set logscale y

plot data u (10**$1):2 w lp title 'XMI', \
     data u (10**$1):3 w lp title 'XMI View', \
     data u (10**$1):4 w lp title 'NeoEMF', \
     data u (10**$1):5 w lp title 'NeoEMF View (Simple)', \
     data u (10**$1):6 w lp title 'NeoEMF View (Full)'
#+end_src

#+RESULTS:
[[file:bench-all-ocl-all-instances.png]]
